<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Altfahrzeug Inzahlungnahme – CARPRO</title>
  <link rel="stylesheet" href="../CSS/einzelangebot.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background: #f8f8f8;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .main-header {
      background: #c82333;
      padding: 0;
      margin: 0;
      box-shadow: 0 3px 12px 0 rgba(44,44,44,0.08);
    }
    .header-center {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      max-width: 1220px;
      margin: 0 auto;
      height: 80px;
      padding: 0 30px;
      gap: 34px;
    }
    .logo {
      height: 46px;
      margin-right: 28px;
      margin-top: 2px;
    }
    .nav-center {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
    }
    .nav-center a {
      color: #fff;
      text-decoration: none;
      font-size: 1.13rem;
      font-weight: 600;
      padding: 11px 22px;
      border-radius: 14px;
      transition: background 0.15s;
      background: rgba(255,255,255,0.04);
    }
    .nav-center a:hover {
      background: #fff2;
      color: #fff;
    }
    .steps-verkauf-container {
      max-width: 1080px;
      margin: 44px auto 0 auto;
      margin-bottom: 34px;
      padding: 0 18px;
    }
    .steps-verkauf-header {
      font-size: 2.3rem;
      font-weight: 800;
      color: #1d1d1d;
      margin-bottom: 14px;
      letter-spacing: -.5px;
      line-height: 1.1;
    }
    .steps-verkauf-header .steps-underline {
      border-bottom: 4px solid #c82333;
      padding-bottom: 4px;
      display: inline-block;
    }
    .steps-verkauf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(252px, 1fr));
      gap: 32px;
    }
    .steps-verkauf-step {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 28px 0 rgba(45,45,45,0.09);
      padding: 36px 22px 30px 26px;
      transition: box-shadow .2s;
      border-left: 7px solid #c82333;
      position: relative;
      min-height: 185px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .steps-verkauf-step .steps-verkauf-number {
      font-size: 2.4rem;
      font-weight: 800;
      color: #c82333;
      line-height: 1;
      margin-bottom: 2px;
      letter-spacing: -.5px;
    }
    .steps-verkauf-step h3 {
      font-size: 1.21rem;
      font-weight: 700;
      color: #222;
      margin: 0 0 7px 0;
    }
    .steps-verkauf-step p {
      color: #444;
      font-size: 1.01rem;
      margin: 0;
      font-weight: 400;
    }
    @media (max-width: 730px) {
      .steps-verkauf-step { padding: 24px 11px 18px 16px; }
      .steps-verkauf-header { font-size: 1.4rem; }
      .steps-verkauf-step .steps-verkauf-number { font-size: 1.5rem; }
      .steps-verkauf-step h3 { font-size: 1.05rem; }
      .steps-verkauf-step { min-height: 140px; }
    }
    .ankauf-container {
      max-width: 820px;
      margin: 44px auto 0 auto;
      background: #fff;
      border-radius: 22px;
      box-shadow: 0 6px 36px 0 rgba(45,45,45,0.12);
      padding: 48px 36px 36px 36px;
      font-family: 'Segoe UI', sans-serif;
    }
    .ankauf-header {
      text-align: center;
      margin-bottom: 18px;
    }
    .ankauf-header h1 {
      color: #c82333;
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 0;
    }
    .ankauf-header p {
      font-size: 1.14rem;
      color: #4c4c4c;
      margin-bottom: 0;
    }
    .ankauf-form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 22px;
      margin-bottom: 18px;
    }
    .ankauf-form-group {
      flex: 1 1 240px;
      min-width: 180px;
      display: flex;
      flex-direction: column;
    }
    .ankauf-form-group label {
      font-weight: 600;
      color: #333;
      margin-bottom: 6px;
    }
    .ankauf-form-group input,
    .ankauf-form-group select,
    .ankauf-form-group textarea {
      padding: 9px 12px;
      border: 1.5px solid #ececec;
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 7px;
      background: #f8f8f8;
      transition: border .18s;
    }
    .ankauf-form-group input:focus,
    .ankauf-form-group select:focus,
    .ankauf-form-group textarea:focus {
      border: 1.5px solid #c82333;
      background: #fff;
    }
    .ankauf-form-group textarea {
      min-height: 48px;
      resize: vertical;
    }
    .ankauf-fahrzeugbilder {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
    }
    .ankauf-fahrzeugbilder input[type="file"] {
      margin-top: 7px;
      font-size: 1rem;
    }
    .ankauf-btn {
      background: #c82333;
      color: #fff;
      font-weight: 700;
      border: none;
      border-radius: 13px;
      font-size: 1.2rem;
      padding: 15px 0;
      margin-top: 22px;
      cursor: pointer;
      width: 100%;
      transition: background .2s;
      box-shadow: 0 4px 18px 0 rgba(200,35,51,0.08);
    }
    .ankauf-btn:hover { background: #a5001a; }
    .bilderliste {
      margin-top: 6px;
      margin-bottom: 8px;
      padding-left: 2px;
      font-size: 1rem;
      color: #1662ba;
    }
    .bilderliste li {
      margin-bottom: 1px;
      font-size: 1rem;
      word-break: break-all;
    }
    .bilderliste-title {
      margin: 0 0 0 0;
      font-size: 1.07rem;
      color: #228741;
      font-weight: 600;
    }
    .bildvorschau-wrapper {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
      margin-bottom: 8px;
    }
    .bildvorschau-img {
      width: 110px;
      height: 68px;
      object-fit: cover;
      border-radius: 8px;
      border: 1.5px solid #e2e2e2;
      background: #f5f5f5;
      box-shadow: 0 1px 5px 0 rgba(10,20,20,0.06);
    }
    @media (max-width: 880px) {
      .ankauf-container {
        padding: 6vw 3vw 3vw 3vw;
        max-width: 99vw;
      }
      .ankauf-form-row { flex-direction: column; gap: 0; }
    }
    /* Modal-Styles */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(20,25,38,0.65);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1002;
    }
    .modal-box {
      background: #fff;
      border-radius: 20px;
      padding: 40px 30px 32px 30px;
      text-align: center;
      max-width: 380px;
      width: 90vw;
      box-shadow: 0 7px 44px 0 rgba(25,28,50,0.15);
      animation: popIn 0.19s cubic-bezier(.7,-0.1,.9,1.5);
    }
    @keyframes popIn {
      0% { transform: scale(0.7);}
      95% { transform: scale(1.05);}
      100% { transform: scale(1);}
    }
    .modal-icon {
      font-size: 3.8rem;
      color: #228741;
      margin-bottom: 8px;
    }
    .modal-btn {
      margin-top: 20px;
      background: #c82333;
      color: #fff;
      font-size: 1.1rem;
      font-weight: 700;
      padding: 12px 28px;
      border: none;
      border-radius: 13px;
      cursor: pointer;
      box-shadow: 0 4px 14px 0 rgba(200,35,51,0.10);
      transition: background .18s;
    }
    .modal-btn:hover { background: #a5001a; }
  </style>
</head>
<body>
  <header class="main-header">
    <div class="header-center">
      <img src="../images/logo.png" alt="CARPRO Logo" class="logo" />
      <nav class="nav-center" id="nav-center"></nav>
    </div>
  </header>
  <!-- Schrittanleitung -->
  <section class="steps-verkauf-container">
    <div class="steps-verkauf-header">
      <span class="steps-underline">So verkaufen Sie Ihr Auto</span>
    </div>
    <div class="steps-verkauf-grid">
      <div class="steps-verkauf-step">
        <div class="steps-verkauf-number">01</div>
        <h3>Kontaktaufnahme</h3>
        <p>
          Füllen Sie das Formular aus oder kontaktieren Sie uns direkt für eine erste Einschätzung.
        </p>
      </div>
      <div class="steps-verkauf-step">
        <div class="steps-verkauf-number">02</div>
        <h3>Fahrzeugbewertung</h3>
        <p>
          Wir bewerten Ihr Fahrzeug schnell, fair und kostenlos. Sie erhalten ein unverbindliches, marktgerechtes Angebot – transparent und ohne versteckte Kosten.
        </p>
      </div>
      <div class="steps-verkauf-step">
        <div class="steps-verkauf-number">03</div>
        <h3>Kaufvereinbarung</h3>
        <p>
          Nach Einigung übernehmen wir die komplette Abwicklung – alle nötigen Unterlagen werden für Sie erstellt, damit der Verkauf schnell und sicher ist.
        </p>
      </div>
      <div class="steps-verkauf-step">
        <div class="steps-verkauf-number">04</div>
        <h3>Dokumentenprüfung</h3>
        <p>
          Wir prüfen alle relevanten Fahrzeugsdokumente und bereiten die Übergabe vor.
        </p>
      </div>
      <div class="steps-verkauf-step">
        <div class="steps-verkauf-number">05</div>
        <h3>Sofortige Auszahlung</h3>
        <p>
          Nach der Übergabe erhalten Sie sofort den vereinbarten Kaufpreis – per Echtzeitüberweisung oder auf Wunsch bar.
        </p>
      </div>
    </div>
  </section>
  <main>
    <div class="ankauf-container">
      <div class="ankauf-header">
        <h1>Altfahrzeug Inzahlungnahme</h1>
        <p>
          Verkaufen Sie Ihr aktuelles Fahrzeug bequem und schnell – einfach Daten eingeben, Bilder hochladen und unverbindliches Angebot erhalten.<br>
          <span style="color:#c82333;font-weight:600;">Kostenlos, sicher und transparent!</span>
        </p>
      </div>
      <form id="ankauf-form" enctype="multipart/form-data">
        <div class="ankauf-form-row">
          <div class="ankauf-form-group">
            <label for="marke">Marke*</label>
            <input type="text" id="marke" name="marke" required>
          </div>
          <div class="ankauf-form-group">
            <label for="modell">Modell*</label>
            <input type="text" id="modell" name="modell" required>
          </div>
          <div class="ankauf-form-group">
            <label for="baujahr">Baujahr*</label>
            <input type="number" id="baujahr" name="baujahr" min="1950" max="2025" required>
          </div>
        </div>
        <div class="ankauf-form-row">
          <div class="ankauf-form-group">
            <label for="kilometerstand">Kilometerstand*</label>
            <input type="number" id="kilometerstand" name="kilometerstand" min="0" step="1" required>
          </div>
          <div class="ankauf-form-group">
            <label for="kraftstoff">Kraftstoffart*</label>
            <select id="kraftstoff" name="kraftstoff" required>
              <option value="">Bitte wählen</option>
              <option>Benzin</option>
              <option>Diesel</option>
              <option>Elektro</option>
              <option>Hybrid</option>
              <option>Gas</option>
              <option>Andere</option>
            </select>
          </div>
          <div class="ankauf-form-group">
            <label for="getriebe">Getriebe*</label>
            <select id="getriebe" name="getriebe" required>
              <option value="">Bitte wählen</option>
              <option>Schaltgetriebe</option>
              <option>Automatik</option>
              <option>Halbautomatik</option>
            </select>
          </div>
        </div>
        <div class="ankauf-form-row">
          <div class="ankauf-form-group" style="flex:2;">
            <label for="beschreibung">Besonderheiten / Zustand</label>
            <textarea id="beschreibung" name="beschreibung" placeholder="z.B. Scheckheftgepflegt, Unfallfrei, neue HU, ..." maxlength="350"></textarea>
          </div>
        </div>
        <div class="ankauf-form-row ankauf-fahrzeugbilder">
          <label for="fahrzeugbilder" style="font-weight:600; margin-bottom:7px;">Fahrzeugbilder hochladen (optional)</label>
          <input type="file" id="fahrzeugbilder" name="fahrzeugbilder" accept="image/*" multiple>
          <div>
            <div class="bilderliste-title" id="bilderliste-title" style="display:none;">Ausgewählte Bilder:</div>
            <ul class="bilderliste" id="bilderliste"></ul>
          </div>
          <div class="bildvorschau-wrapper" id="bildvorschau"></div>
        </div>
        <hr style="margin:24px 0 18px 0;">
        <div class="ankauf-header" style="margin-bottom:10px;">
          <h2 style="color:#c82333;font-size:1.3rem;margin-bottom:5px;">Kontaktdaten</h2>
        </div>
        <div class="ankauf-form-row">
          <div class="ankauf-form-group">
            <label for="vorname">Vorname*</label>
            <input type="text" id="vorname" name="vorname" required>
          </div>
          <div class="ankauf-form-group">
            <label for="nachname">Nachname*</label>
            <input type="text" id="nachname" name="nachname" required>
          </div>
        </div>
        <div class="ankauf-form-row">
          <div class="ankauf-form-group">
            <label for="email">E-Mail*</label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="ankauf-form-group">
            <label for="telefon">Telefon</label>
            <input type="tel" id="telefon" name="telefon">
          </div>
        </div>
        <button type="submit" class="ankauf-btn">Anfrage absenden</button>
      </form>
    </div>
  </main>

  <!-- Erfolgs-Modal -->
  <div id="ankauf-success-modal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
      <div class="modal-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Ihre Anfrage wurde erfolgreich übermittelt!</h2>
      <p>
        Herzlichen Dank für Ihr Vertrauen.<br>
        Wir haben Ihre Angaben erhalten und prüfen diese umgehend.<br>
        Unser Team meldet sich in Kürze mit einem persönlichen Angebot.
      </p>
      <button id="close-success-modal" class="modal-btn">Schließen</button>
    </div>
  </div>

  <script>
    // Header wie gehabt
    function updateHeaderUser() {
      const navCenter = document.getElementById("nav-center");
      const userName = localStorage.getItem("userName");
      if (userName) {
        navCenter.innerHTML = `
          <a href="startseite.html">Startseite</a>
          <a href="fahrzeugbestand.html">Fahrzeugbestand</a>
          <a href="#">Services</a>
          <a href="kontakt.html">Kontakt</a>
          <a href="profil.html" id="profil-link"><i class="fas fa-user"></i> Profil ansehen</a>
          <a href="#" id="logout-link">Logout</a>
        `;
        document.getElementById("logout-link").onclick = (e) => {
          e.preventDefault();
          localStorage.removeItem("userName");
          updateHeaderUser();
        };
      } else {
        navCenter.innerHTML = `
          <a href="startseite.html">Startseite</a>
          <a href="fahrzeugbestand.html">Fahrzeugbestand</a>
          <a href="#">Services</a>
          <a href="kontakt.html">Kontakt</a>
          <a href="#" id="login-link"><i class="fas fa-user"></i> Login</a>
        `;
        document.getElementById("login-link").onclick = (e) => {
          e.preventDefault();
          document.getElementById("login-modal").style.display = "flex";
        };
      }
    }
    document.addEventListener("DOMContentLoaded", updateHeaderUser);

    // Bild-Dateinamen & Vorschau direkt anzeigen (lokal!)
    const bilderInput = document.getElementById('fahrzeugbilder');
    const bilderListe = document.getElementById('bilderliste');
    const bilderListeTitle = document.getElementById('bilderliste-title');
    const bildVorschau = document.getElementById('bildvorschau');
    bilderInput.addEventListener('change', function() {
      bilderListe.innerHTML = '';
      bildVorschau.innerHTML = '';
      if (this.files.length > 0) {
        bilderListeTitle.style.display = 'block';
        Array.from(this.files).forEach(file => {
          const li = document.createElement('li');
          li.textContent = file.name;
          bilderListe.appendChild(li);

          // Vorschau für Bilder (MEHRERE!)
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(ev) {
              const img = document.createElement('img');
              img.src = ev.target.result;
              img.className = 'bildvorschau-img';
              bildVorschau.appendChild(img);
            }
            reader.readAsDataURL(file);
          }
        });
      } else {
        bilderListeTitle.style.display = 'none';
      }
    });

    // Modal Success-Handling
    const ankaufSuccessModal = document.getElementById('ankauf-success-modal');
    const closeModalBtn = document.getElementById('close-success-modal');
    closeModalBtn.onclick = () => {
      ankaufSuccessModal.style.display = 'none';
      window.scrollTo({top:0, behavior:'smooth'});
    };
    ankaufSuccessModal.onclick = (e) => {
      if (e.target === ankaufSuccessModal) ankaufSuccessModal.style.display = 'none';
    };

    // Formular absenden (mit Modal)
    document.getElementById("ankauf-form").onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      try {
        const res = await fetch("/api/ankauf", {
          method: "POST",
          body: formData
        });
        const data = await res.json();
        if (data.success) {
          form.reset();
          bilderListe.innerHTML = '';
          bilderListeTitle.style.display = 'none';
          bildVorschau.innerHTML = '';
          ankaufSuccessModal.style.display = 'flex';
        } else {
          alert(data.message || "Es ist ein Fehler aufgetreten.");
        }
      } catch (err) {
        alert("Serverfehler beim Versenden des Formulars.");
      }
    };
  </script>
</body>
</html>
